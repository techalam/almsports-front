(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[15],{9242:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/Products",function(){return r(2637)}])},2637:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return Z}});var a=r(5893),s=r(7294),l=r(4051),i=r(5005),o=r(2529),c=r(1555),n=r(1330),d=r(2777),u=r(4162),p=r(7066),h=r(1252),m=r(1129),x=r(6455),g=r.n(x),v=e=>{let{show:t,handleClose:r,selectedProduct:l,saveProduct:c,updateProduct:n,collections:d,user:x}=e,[v,j]=(0,s.useState)(""),[y,f]=(0,s.useState)(""),[Z,b]=(0,s.useState)(""),[w,C]=(0,s.useState)(""),[N,P]=(0,s.useState)([]),[k,E]=(0,s.useState)({});(0,s.useEffect)(()=>{l?(j(l.name||""),f(l.description||""),b(l.price||""),C(l.category||""),P(l.images||[])):(j(""),f(""),b(""),C(""),P([]))},[l]);let S=async e=>{let t=Array.from(e.target.files).map(e=>_(e)),r=(await Promise.all(t)).filter(Boolean);P(e=>[...e,...r])},_=async e=>{let t=new FormData;t.append("file",e),t.append("upload_preset","products");try{return(await p.Z.post("https://api.cloudinary.com/v1_1/ddmmklctb/image/upload",t)).data.secure_url}catch(e){return console.error("Image upload failed:",e),null}},I=e=>{P(t=>t.filter(t=>t!==e))},A=()=>{let e={};return v||(e.productName="Product name is required."),y||(e.productDescription="Description is required."),(!Z||isNaN(Z)||Z<=0)&&(e.productPrice="Price must be a positive number."),w||(e.productCategory="Category is required."),0===N.length&&(e.productImages="At least one image is required."),E(e),0===Object.keys(e).length},F=async()=>{if(!A())return;let e={name:v,description:y,price:Z,category:w,images:N};try{l?await n(l.id,e):await c(e),g().fire({icon:"success",title:"Success!",text:l?"Product updated successfully":"Product created successfully"}),r()}catch(e){console.error("Submit error:",e),g().fire({icon:"error",title:"Error",text:"An error occurred while saving the product."})}};return(0,a.jsxs)(u.Z,{show:t,onHide:r,size:"lg",children:[(0,a.jsx)(u.Z.Header,{closeButton:!0,children:(0,a.jsx)(u.Z.Title,{children:l?"Update Product":"Create Product"})}),(0,a.jsx)(u.Z.Body,{children:(0,a.jsxs)(o.Z,{children:[(0,a.jsxs)(o.Z.Group,{className:"mb-3",children:[(0,a.jsx)(o.Z.Label,{children:"Name"}),(0,a.jsx)(o.Z.Control,{type:"text",value:v,onChange:e=>j(e.target.value),isInvalid:!!k.productName,required:!0}),(0,a.jsx)(o.Z.Control.Feedback,{type:"invalid",children:k.productName})]}),(0,a.jsxs)(o.Z.Group,{className:"mb-3",children:[(0,a.jsx)(o.Z.Label,{children:"Description"}),(0,a.jsx)(o.Z.Control,{as:"textarea",rows:3,value:y,onChange:e=>f(e.target.value),isInvalid:!!k.productDescription,required:!0}),(0,a.jsx)(o.Z.Control.Feedback,{type:"invalid",children:k.productDescription})]}),(0,a.jsxs)(o.Z.Group,{className:"mb-3",children:[(0,a.jsx)(o.Z.Label,{children:"Price"}),(0,a.jsx)(o.Z.Control,{type:"number",value:Z,onChange:e=>b(e.target.value),isInvalid:!!k.productPrice,required:!0}),(0,a.jsx)(o.Z.Control.Feedback,{type:"invalid",children:k.productPrice})]}),(0,a.jsxs)(o.Z.Group,{className:"mb-3",children:[(0,a.jsx)(o.Z.Label,{children:"Category"}),(0,a.jsxs)(h.Z,{value:w,onChange:e=>C(e.target.value),style:{width:"100%",height:"40px"},displayEmpty:!0,children:[(0,a.jsx)(m.Z,{value:"",children:"Select category"}),d.map(e=>(0,a.jsx)(m.Z,{value:e.label,children:e.label},e.value))]}),k.productCategory&&(0,a.jsx)("div",{className:"text-danger mt-1",children:k.productCategory})]}),(0,a.jsxs)(o.Z.Group,{children:[(0,a.jsx)(o.Z.Label,{children:"Images"}),(0,a.jsx)(o.Z.Control,{type:"file",multiple:!0,onChange:S,isInvalid:!!k.productImages}),k.productImages&&(0,a.jsx)("div",{className:"text-danger mt-1",children:k.productImages}),(0,a.jsx)("div",{className:"d-flex flex-wrap mt-2",children:null==N?void 0:N.map((e,t)=>(0,a.jsxs)("div",{style:{position:"relative",marginRight:10},children:[(0,a.jsx)("img",{src:e,alt:"Product",style:{width:100,height:100,objectFit:"cover",borderRadius:4}}),(0,a.jsx)(i.Z,{variant:"danger",size:"sm",onClick:()=>I(e),style:{position:"absolute",top:-5,right:-5,padding:2,borderRadius:"50%"},children:"\xd7"})]},t))})]})]})}),(0,a.jsxs)(u.Z.Footer,{children:[(0,a.jsx)(i.Z,{variant:"secondary",onClick:r,children:"Cancel"}),(0,a.jsx)(i.Z,{variant:"primary",onClick:F,children:l?"Update Product":"Save Product"})]})]})},j=r(9473),y=r(1163),f=()=>{let[e,t]=(0,s.useState)(!1),[r,u]=(0,s.useState)(null),[x,f]=(0,s.useState)([]),[Z,b]=(0,s.useState)(""),[w,C]=(0,s.useState)(1),[N,P]=(0,s.useState)(0),[k]=(0,s.useState)(10),E=(0,j.v9)(e=>e.auth),[S,_]=(0,s.useState)([]),[I,A]=(0,s.useState)(""),F=(0,y.useRouter)(),q=()=>{t(!1)},B=async e=>{try{let t=await p.Z.post("https://almsports-node-techalams-projects.vercel.app/api/products/createProduct",e,{headers:{Authorization:"Bearer ".concat(null==E?void 0:E.accessToken)}});console.log("Product created:",t.data),g().fire({icon:"success",title:"Product Created",text:'Product "'.concat(t.data.name,'" was successfully created.')}),D(),q()}catch(e){var t,r;console.error("Error creating product:",e),g().fire({icon:"error",title:"Error",text:(null==e?void 0:null===(r=e.response)||void 0===r?void 0:null===(t=r.data)||void 0===t?void 0:t.error)||"Failed to create product."})}},D=async()=>{try{let e=await p.Z.get("https://almsports-node-techalams-projects.vercel.app/api/products/products?category=".concat(I||""),{headers:{Authorization:"Bearer ".concat(null==E?void 0:E.accessToken)},params:{limit:k,offset:(w-1)*k,name:Z}});f(e.data),P(e.headers["x-total-count"])}catch(r){var e,t;console.error("Error fetching products:",r),g().fire({icon:"error",title:"Error fetching products",text:(null==r?void 0:null===(t=r.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.error)||"Error fetching products!"})}},z=async()=>{var e,t,r;try{let t=await p.Z.get("https://almsports-node-techalams-projects.vercel.app/api/products/collections",{headers:{Authorization:"Bearer ".concat(null==E?void 0:E.accessToken)}});console.log("All collections:",t.data);let r=null==t?void 0:null===(e=t.data)||void 0===e?void 0:e.map(e=>({value:e.name,label:e.name}));return _(r),t.data}catch(e){console.error("Error fetching collections:",e),g().fire({icon:"error",title:"Error fetching collections",text:(null==e?void 0:null===(r=e.response)||void 0===r?void 0:null===(t=r.data)||void 0===t?void 0:t.error)||"Error fetching collections!"})}},L=e=>{C(e)};return(0,s.useEffect)(()=>{D()},[Z,w,I]),(0,s.useEffect)(()=>{z()},[]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(l.Z,{className:"d-flex justify-content-between align-items-center px-3",children:[(0,a.jsx)("h5",{style:{width:"auto",margin:0,padding:0},children:"Products"}),(0,a.jsxs)(i.Z,{size:"sm",variant:"primary",className:"mt-2",style:{width:"35%",background:"linear-gradient(135deg, #43cea2, #185a9d)",border:"none"},onClick:()=>{u(null),t(!0)},children:[(0,a.jsx)(d.OvN,{})," \xa0Add New"]})]}),(0,a.jsx)(o.Z.Control,{className:"mt-3 p-2",type:"text",placeholder:"Search Product Name",value:Z,onChange:e=>{b(e.target.value),C(1)}}),(0,a.jsx)(l.Z,{className:"d-flex justify-content-end align-items-center mt-2 px-3",children:(0,a.jsxs)(h.Z,{value:I,onChange:e=>A(e.target.value),style:{width:"50%",height:"30px"},className:"m-0 p-0",displayEmpty:!0,children:[(0,a.jsx)(m.Z,{value:"",children:"All"}),S.map(e=>(0,a.jsx)(m.Z,{value:e.value,children:e.label},e.value))]})}),(0,a.jsx)(l.Z,{style:{flexWrap:"wrap",overflow:"auto"},className:"mt-2 g-4 d-flex wrap align-items-center justify-content-center",xs:1,sm:2,md:3,lg:4,children:x.map(e=>(0,a.jsxs)(c.Z,{xs:5,sm:5,md:5,lg:5,style:{height:"200px",cursor:"pointer"},onClick:()=>{F.push("/productDetails?id=".concat(e.id))},className:"shadow-sm rounded-3 m-2 border-0",children:[(0,a.jsx)(n.Z,{style:{height:"120px",width:"90%",objectFit:"contain"},src:e.images&&e.images[0]||"./images/noImg.webp",onError:e=>{e.target.onerror=null,e.target.src="./images/noImg.webp"}}),(0,a.jsx)("h6",{style:{fontWeight:"lighter",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis"},children:e.name}),(0,a.jsxs)("h6",{children:["Rs: ",e.price]})]},e.id))}),(0,a.jsxs)("div",{className:"d-flex justify-content-between mt-3",children:[(0,a.jsx)(i.Z,{variant:"outline-primary",onClick:()=>L(w-1),disabled:1===w,children:"Previous"}),(0,a.jsx)("span",{className:"mx-2",children:w}),(0,a.jsx)(i.Z,{variant:"outline-primary",onClick:()=>L(w+1),disabled:w*k>=N,children:"Next"})]}),(0,a.jsx)(v,{show:e,handleClose:q,selectedProduct:r,saveProduct:B,updateProduct:(e,t)=>{console.log("Product updated:",e,t),q()},collections:S,getAllProducts:D})]})};function Z(){return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(f,{})})}}},function(e){e.O(0,[529,251,777,162,134,888,774,179],function(){return e(e.s=9242)}),_N_E=e.O()}]);